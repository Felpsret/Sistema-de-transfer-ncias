<!DOCTYPE html>
<html lang="pt-br" class="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Transferência de Produtos</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = { darkMode: "class" };
    </script>

    <!-- Tabler Icons -->
    <link rel="stylesheet" href="https://unpkg.com/@tabler/icons-webfont/dist/tabler-icons.min.css" />

    <!-- Scanner (QR/Barcode) -->
    <script src="https://unpkg.com/html5-qrcode@2.3.8/minified/html5-qrcode.min.js"></script>

    <!-- Estilos -->
    <style>
      @keyframes fade-in { from { opacity: 0; transform: translateY(6px) scale(.98);} to { opacity: 1; transform: none; } }
      .animate-fade-in { animation: fade-in .22s ease-out both; }
      .focus-ring:focus-visible { outline: none; box-shadow: 0 0 0 3px rgba(59,130,246,.45); }
      .btn-lg { padding: 14px 16px; font-size: 1.1rem; border-radius: .75rem; }
      .chip { border-radius: 999px; padding: .25rem .6rem; border: 1px solid rgba(148,163,184,.5); }
      [aria-invalid="true"]{ border-color:#ef4444 !important; box-shadow:0 0 0 2px rgba(239,68,68,.25); }
    </style>
  </head>
  <body class="bg-gray-50 dark:bg-gray-900 min-h-screen text-gray-900 dark:text-gray-100 p-4 flex flex-col items-center">

    <!-- Header -->
    <header class="w-full max-w-md mb-5">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-3">
          <img src="logo.png" alt="Logo" class="h-10 w-auto rounded" onerror="this.style.display='none'" />
          <h1 class="text-2xl font-bold text-blue-700 dark:text-blue-400">Transferência de Produtos</h1>
        </div>
        <button id="toggle-tema" class="focus-ring inline-flex items-center justify-center h-10 w-10 rounded-xl bg-white/70 dark:bg-gray-800/70 shadow" title="Alternar tema" aria-label="Alternar tema">
          <i id="tema-icone" class="ti ti-moon text-xl"></i>
        </button>
      </div>
    </header>

    <!-- Main -->
    <main class="w-full max-w-md space-y-6">
      <!-- Formulário -->
      <section class="bg-white dark:bg-gray-800 rounded-2xl shadow p-5 animate-fade-in">
        <form id="transfer-form" class="space-y-5" autocomplete="off">
          <!-- Produtos -->
          <div>
            <div class="flex items-center justify-between mb-2">
              <label class="block text-sm font-semibold">Produtos</label>
              <div class="flex items-center gap-2">
                <button type="button" id="btn-scan" class="focus-ring inline-flex items-center gap-2 rounded-lg bg-indigo-600 hover:bg-indigo-700 text-white text-sm font-semibold px-3 py-2"><i class="ti ti-scan"></i> Ler código</button>
                <button type="button" id="btn-add-produto" class="focus-ring inline-flex items-center gap-2 rounded-lg bg-blue-600 hover:bg-blue-700 text-white text-sm font-semibold px-3 py-2"><i class="ti ti-plus"></i> Adicionar</button>
              </div>
            </div>

            <!-- Chips -->
            <div class="flex flex-wrap gap-2 mb-2">
              <button class="chip text-xs" type="button" data-quick="ONT">ONT</button>
              <button class="chip text-xs" type="button" data-quick="Roteador">Cabo Flat</button>
              <button class="chip text-xs" type="button" data-quick="Cabo Drop 80m">Conector azul</button>
              <button class="chip text-xs" type="button" data-quick="Conector SC/APC">Conector Verde</button>
            </div>

            <div id="produtos-lista" class="space-y-2"></div>

            <datalist id="cat-produtos">
              <option>Alça apf</option>
              <option>Alça Prf</option>
              <option>Conector Verde</option>
              <option>Conector azul</option>
              <option>Splitter 1x8</option>
              <option>Splitter 1x16</option>
              
            </datalist>

            <p class="text-xs text-gray-500 mt-2">Dica: pressione <kbd class="px-1.5 py-0.5 rounded bg-gray-100 dark:bg-gray-700">Enter</kbd> na quantidade para criar outra linha.</p>
          </div>

          <!-- Origem/Destino -->
          <div class="grid gap-3">
            <div>
              <label class="block text-sm font-semibold mb-1">Setor de Origem</label>
              <select id="setor-origem" required class="focus-ring w-full border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 text-base dark:bg-gray-700">
                <option value="" disabled selected>Selecione…</option>
                <option value="almox">Almoxarifado</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-semibold mb-1">Setor de Destino</label>
              <select id="setor-destino" required class="focus-ring w-full border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 text-base dark:bg-gray-700">
                <option value="" disabled selected>Selecione…</option>
              </select>
            </div>
          </div>

          <!-- Ações -->
          <div class="flex flex-col gap-2">
            <button type="submit" class="focus-ring bg-blue-600 hover:bg-blue-700 text-white font-semibold btn-lg w-full flex items-center justify-center gap-2">
              <i class="ti ti-arrow-right-arrow-left"></i> Transferir
            </button>
            <button type="reset" id="btn-limpar" class="focus-ring bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-900 dark:text-gray-100 font-medium btn-lg w-full">Limpar formulário</button>
          </div>
        </form>
      </section>

      <!-- Histórico -->
      <section class="bg-white dark:bg-gray-800 rounded-2xl shadow p-5 animate-fade-in">
        <div class="flex items-center justify-between mb-3">
          <h2 class="text-lg font-semibold flex items-center gap-2"><i class="ti ti-history text-blue-600 dark:text-blue-400"></i> Histórico</h2>
          <div class="flex gap-2">
            <button id="btn-export" class="focus-ring inline-flex items-center gap-2 rounded-lg bg-emerald-600 hover:bg-emerald-700 text-white text-sm font-semibold px-3 py-2"><i class="ti ti-download"></i> Exportar CSV</button>
            <button id="btn-apagar" class="focus-ring inline-flex items-center gap-2 rounded-lg bg-red-600 hover:bg-red-700 text-white text-sm font-semibold px-3 py-2"><i class="ti ti-trash"></i> Apagar tudo</button>
          </div>
        </div>
        <input id="busca" type="search" placeholder="Filtrar… (produto/origem/destino)" class="focus-ring w-full border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 text-sm dark:bg-gray-700 mb-3" />
        <ul id="historico" class="space-y-2 text-sm"></ul>
        <div id="vazio" class="hidden py-6 text-center text-sm text-gray-500">Nenhuma transferência registrada ainda.</div>
      </section>
    </main>

    <!-- Template linha de produto -->
    <template id="tpl-produto">
      <div class="flex gap-2 group">
        <input type="text" list="cat-produtos" placeholder="Produto" class="focus-ring produto-input flex-1 border rounded-lg px-3 py-2 dark:bg-gray-700" required />
        <input type="number" placeholder="Qtd" min="1" class="focus-ring quantidade-input w-24 border rounded-lg px-3 py-2 dark:bg-gray-700" required />
        <button type="button" class="focus-ring shrink-0 inline-flex items-center justify-center rounded-lg px-2 text-gray-500 hover:text-red-600" data-acao="remover"><i class="ti ti-minus"></i></button>
      </div>
    </template>

    <!-- Script -->
    <script>
      const qs = (s,el=document)=>el.querySelector(s);
      const qsa = (s,el=document)=>Array.from(el.querySelectorAll(s));
      const STORAGE_KEY='transferencias';

      const form=qs('#transfer-form'), lista=qs('#produtos-lista'), historico=qs('#historico'), vazio=qs('#vazio');

      function criarLinhaProduto(values={nome:'',quantidade:''}){
        const node=qs('#tpl-produto').content.firstElementChild.cloneNode(true);
        const [inpNome,inpQtd]=qsa('input',node);
        inpNome.value=values.nome||''; inpQtd.value=values.quantidade||'';
        node.querySelector('[data-acao="remover"]').addEventListener('click',()=>{node.remove();if(!lista.children.length)adicionarProduto();});
        return node;
      }
      function adicionarProduto(prefill){ lista.appendChild(criarLinhaProduto(prefill)); }
      function coletarProdutos(){
        return qsa('#produtos-lista .group').map(row=>{
          const nome=row.querySelector('.produto-input').value.trim();
          const qtd=row.querySelector('.quantidade-input').value.trim();
          if(nome&&qtd>0)return{nome,quantidade:qtd};
        }).filter(Boolean);
      }
      function salvarRegistro(dados){
        const registros=JSON.parse(localStorage.getItem(STORAGE_KEY))||[];
        registros.push({...dados,data:new Date().toLocaleString()});
        localStorage.setItem(STORAGE_KEY,JSON.stringify(registros));
        renderHistorico();
      }
      function renderHistorico(){
        historico.innerHTML='';const regs=JSON.parse(localStorage.getItem(STORAGE_KEY))||[];
        if(!regs.length){vazio.classList.remove('hidden');return;}vazio.classList.add('hidden');
        regs.forEach(r=>{const li=document.createElement('li');li.className='bg-gray-100 dark:bg-gray-700 p-3 rounded';
          li.innerHTML=`<div class="font-semibold">${r.origem} → ${r.destino}</div><div>${r.produtos.map(p=>`${p.nome} (${p.quantidade})`).join(', ')}</div><div class="text-xs text-gray-500">${r.data}</div>`;
          historico.appendChild(li);});
      }
      form.addEventListener('submit',e=>{
        e.preventDefault();
        const origem=qs('#setor-origem').value,destino=qs('#setor-destino').value,produtos=coletarProdutos();
        if(!origem||!destino||!produtos.length)return;
        salvarRegistro({origem,destino,produtos});
        form.reset();lista.innerHTML='';adicionarProduto();
      });
      qs('#btn-add-produto').addEventListener('click',()=>adicionarProduto());
      adicionarProduto();renderHistorico();
    </script>
  </body>
</html>
